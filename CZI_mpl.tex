\documentclass[11pt]{article}  % min is 11pt

\usepackage[margin=1in]{geometry}  % min is .5 in
\usepackage[shortlabels]{enumitem}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{footmisc}
\usepackage[hidelinks]{hyperref}



\begin{document}
\title{Matplotlib - Foundation of Visualization in Python}
\author{}
\maketitle

\section{Goals}

Matplotlib (\url{http://matplotlib.org}) is the fundamental data
visualization library for the scientific Python stack of tools,
providing plotting functionality used by over a million\footnote{Estimated
from \texttt{pypi} download numbers, \texttt{conda} download numbers,
and the number of unique monthly visitors to the documentation
website} scientists in conjunction with other foundational tools like
Numpy and SciPy (\url{https://www.scipy.org/about.html}).  It is used
across a wide spectrum of fields, including bio-medical imaging,
microscopy, and genomics
\cite{Carpenter2006,Wolf2018,10.7717/peerj.453}
\cite{Segata2011,10.1371/journal.pgen.1000695,HASHIMSHONY2012666,
  10.1093/bioinformatics/bts480,Carlile2014,Laganowsky2014,Jiangaac9462,
  10.3389/fninf.2014.00014}, and we expect the user base to continue
to grow as Python is adopted by more scientists in the life
sciences. There are many downstream packages that build on Matplotlib
to implement domain-specific plotting tools.

Matplotlib has been actively developed and maintained by a vibrant,
primarily volunteer, community over the last 16 years.  However, given
the scale, scope, and importance of the project, we are at the limit
of what can be developed and maintained with a primarily volunteer
effort.

This proposal supports 2.4 person years of developer time for
Matplotlib, laying the groundwork for guiding
the project through the next 16 years:

\begin{enumerate}[label=\alph*),noitemsep]
  \item Maintenance of the library, including curating new and
    existing Issues and Pull Requests.
  \item Developing a comprehensive plan to evolve the core architecture
    of Matplotlib.
  \item Developing the tools, documentation, and community to foster a
    rich eco-system of domain-specific plotting tools built on
    Matplotlib.
\end{enumerate}


% The goal is the maintenance; curating is the method of achieving it.
\subsection{Maintenance and Growth of Library and Community}

% JMK Try to start paragraphs with what you will do, and then defend
% why it is necessary
% JMK I'm pretty skeptical that CZI will find closing issues sexy
% enough.  Thats why I was suggesting curation and community-building
% as a way to express the same thing.

Matplotlib is a community-driven project, but we have grown to the point
where we need supported developers with the time to organize, plan, and
make timely decisions.  Currently, new Issues and Pull Requests are
being submitted faster than our volunteers can review them.  Over the
past few years we have merged PRs and closed Issues at about [X per
  month], but about [Y] new issues and PRs are opened monthly;
currently we have about 1200 open issues and 300 open PRs.  Among the
latter are useful contributions and bug fixes that, possibly with
additional attention and polish, could improve Matplotlib for direct
users and downstream packages.  The backlog is discouraging for new or
occasional contributors, and distracting for core developers.

To maintain Matplotlib's health we need to do the following:

\begin{itemize}[noitemsep]
\item Curate the current backlog of Issues and Pull Requests
  in terms of topic, difficulty, and urgency.
\item Label and review newly opened Issues and Pull Requests
  promptly.
\item Fix critical bugs and regressions promptly.
\item On-board new contributors to the project team; this is critical to
  sustaining and diversifying our developer community.
  % AL had concerns about this being an agressive growth target, I think
  % of this more in terms of making sure we are bring people on to offset
  % the people eventually rolling off (for what ever reason)
  %JMK: We hav a backlog of PRs largely because we don't have enough people to review them. I think a larger community is key.
\item Maintain backward compatibility.  If we do break API, ensure it
  is intentional and well documented.
\item Manage discussions about proposed enhancements, features, and
  breaking API changes.
\end{itemize}

The requested support for developers is intended to complement and
faciliate, not replace, the crucial work by volunteers.  We aim to
better co-ordinate and nurture their
efforts, with the goal of growing and sustaining a diverse community
of expert contributors, both volunteer and paid.  We view
this proposal as the start of a new phase for Matplotlib, in which we
will need to find support from a variety of sources in the coming years.
% Realistically, don't we need *some* funding for paid work to
% continue after this?  I don't think this is a one-shot cure-all.
% Agree, this is at best a jump start / down payment on future funding

% Cite Ipython, Jupyter, Numpy as our models or inspiration in this?


\subsection{Road-map and Architecture}

Matplotlib needs sustained attention to design the library's
architecture for the next decade.  The current
architecture\footnote{https://www.aosabook.org/en/matplotlib.html} of
Matplotlib was developed 15 years ago \cite{Hunter:2007}.  That it is
still in use is a testament to its initial design; but that design
does not reflect recent developments in data structures, software
design, and visualization.  Matplotlib does not natively know how to
exploit structured (e.g. \texttt{pandas} or \texttt{xarray}) or
streaming data.  Some of the design choices about data structures and
name space organization are
becoming unwelcome constraints as Matplotlib scales to more domains.  While
there are many downstream domain-specific libraries that are built on
top of Matplotlib, interoperability between them is problematic.

%% We will develop
%% plans for refactoring the core library to facilitate its extension and
%% to smooth interoperability among the core library and the various
%% domain-specific plotting tools.
%% We will investigate how to update Matplotlib's
%% internal data model to use the information embedded in structured
%% data and allow fluid updating.

\subsubsection{Homogenization of the Application Programming Interface (API)}
\label{sec:api_hom}
The library has grown organically over time through the contributions
of many people (approx. 900 individuals), and the code has accumulated
many small inconsistencies in the API.  Similar methods have different
argument order, e.g., \texttt{ax.text(x, y, s)} vs
\texttt{ax.annotation(s, (x, y))}, and some keyword arguments can be
singular or plural, e.g., \texttt{color} vs \texttt{colors}.  These
subtle issues add friction for users, but are hard to fix without
breaking existing code somewhere in our large user base.  Our goal is
to minimize breakage, but still unify the API.  Taking into account
\textbf{all} of the APIs, we will carefully consider which to leave as
they are, which to deprecate, and which to replace.

\subsubsection{API generalization}
\label{sec:api_gen}
Currently Matplotlib has two main user-facing APIs: the
\texttt{pyplot} API and the \texttt{Object Oriented} (\texttt{OO})
API.  The \texttt{pyplot} API closely follows MATLAB and is built
around the concept of a global ``current Axes''.  While convenient for
quick interactive usage, it frequently produces surprising and
undesired coupling between in the code when used in libraries.  On the
% Something is missing in the line above, but I don't know what it is...
other hand the \texttt{OO} interface is more explicit and flexible but
more verbose.  The main name space for plotting methods is
the \texttt{Axes} class, which leads to three issues with the API.
First, third party domain-specific packages can never feel ``First
Class'', as their plotting functions will not be implemented as \texttt{Axes} methods like
the ``built in'' plots.  Second, some visualizations require putting
\texttt{Artist}s on multiple \texttt{Axes}; this doesn't fit the model
in which Artists are made via \texttt{Axes} methods.  Lastly, there are over 250
methods on the \texttt{Axes}---all of the plotting methods and some
additional \texttt{Axes} specific methods---which makes it extremely
hard to use tab-completion to search for a method.

To address these issues we will move to a primary API in which top-level
functions take
in data, style, and \texttt{Axes}s.  During this
refactoring we will use consistent naming and call conventions, as
discussed in \ref{sec:api_hom}, that can be used by downstream
libraries.  These functions will return the rich composites discussed
in section \ref{sec:artists} and consume the data objects discussed in
section \ref{sec:dm}.  From the large pool of plotting functions we
will curate domain-specific name spaces, which can be augmented by
downstream libraries to enable users to discover the functionality
they need.

This is a huge change in the API that will require time to carefully
consider the consequences.
% Does this mean it the consequences might be so bad that it won't be
% pursued?  My point is that the sentence is true--but its role in the
% proposal is unclear to me.  I'm not sure it is what you really want
% to say here.



\subsubsection{Rich, Semantic \texttt{Artist}s}
\label{sec:artists}
\texttt{Artist}s are the ``middle layer'' of Matplotlib that encode
user-intent, style, and data.
To update the style or data users interact with the \texttt{Artist}
objects, and \texttt{Artist}s know how to turn the user's input into
colored pixels.
%too glib?
Currently, Matplotlib has a mix of ``primitive'' \texttt{Artist}s
(e.g. lines, images, and text) and ``composite'' artists (e.g.,
the whole \texttt{Figure}).

The mapping between the user API and the \texttt{Artist}s can be
one-to-one, but often one user call will generate many decoupled
\texttt{Artist}s.  For example, \texttt{hist} displays a histogram,
but returns a list of independent \texttt{Rectangle} \texttt{Artist}s
(one per bin).  If the user wants to update the data or the style,
they must adjust each \texttt{Rectangle} independently.  While
technically possible, this makes developing interactive figures and
animations is significantly harder than it should be.  Instead, the
functions discussed in \ref{sec:api_gen} should return objects that
have a uniform interface to update their data and style to make
interactive visualization development accessible to all users.

% This still needs work.  Maybe the point is that composite artists
% will be smarter, more widely used, and more uniform in their interface?


\subsubsection{Data Model}
\label{sec:dm}

``Structured data'' combines multiple pieces of, possibly
heterogeneous, data along with labels, metadata, and the the
relationship between the components into single data structure is
not natively supported by Matplotlib.
 Currently users must split the structures up and pass the
components individually into
plotting methods, destroying the structure.


Further, each plotting method and \texttt{Artist}s handle sanitizing
and storing data independently.  This means that some common
functionality, such as handling data with attached units (e.g.,
degrees Celsius, dates), is scattered throughout the code base.  This
leads to inconsistencies across library and makes it difficult to
write code that updates the data or style for interactive exploration,
streaming, and animation use cases.


We will re-organize the internal data representation in Matplotlib to
a model appropriate for the base Matplotlib library and, more
importantly, to be the technical underpinning to handle, exploit, and
update structured data in a coherent fashion.
By removing the direct data storage from
the \texttt{Artist}s and defining an API for data sources we will enable:
\begin{itemize}[noitemsep]
  \item native consumption of structured data;
  \item smart down sampling of plotted data based on view limits;
  \item seamless update the underlying data, either
    streaming or interactively;
  %% this one maybe too much, cool idea, but not really mentioned anywhere else
  \item non-materialized data sources such as database queries or analytic functions
\end{itemize}
We will decouple the development of the data access from the
\texttt{Artist}s.  Downstream libraries will be able to provide
sophisticated data sources to the \texttt{Artists} in the core library
or sophisticated that \texttt{Artist}s that use the data sources from
core.


\subsubsection{Additional Export Methods}

Matplotlib \texttt{Figure}s can be render to either raster or vector
file formats.  From there it is displayed to an interactive window or
saved to disk and be used like any other image file.  There is
currently no good way to ``reopen'' a Matplotlib \texttt{Figure} or
export it to another plotting library, such as \texttt{bokeh},
\texttt{d3} or \texttt{QtCharts}.  Due to the way Matplotlib
internals are implemented, it is difficult to take advantage GPUs to
accelerate drawing.

To address these problems we will investigate adding two additional
export paths.  One at a high-level, suitable for a Matplotlib-specific
file format and interoperability with other high-level plotting
libraries, and one at a low level scene-graph level, suitable to pass
to a GPU.


\subsection{Coordination with downstream projects}


The most common visualizations in a domain need to be one or two
simple lines of code for the end-practitioners with the ``obvious''
customization options surfaced.  Our goal is to make these libraries
as thin and easy to write as possible.  This means there will always
be a need for domain specific visualization libraries.  Much of the
domain-specific specialization is carried in the semantics of the
structured data and the specific visualization needs of the domain.


To this end we will identify and engage with downstream libraries in
the life sciences that are currently using Matplotlib for their
visualization to identify their pain points and ensure that we are
actually solving their problems.  In particular we plan to engage with
\texttt{scikit-learn}\footnote{Also applying for Essential Open Source
Software for Science}, \texttt{CellProfiler}\footnote{Currently funded
by CZI\label{f:czi}}, \texttt{scanpy}\footref{f:czi},
\texttt{starfish}\footref{f:czi}, \texttt{nipy}, and
\texttt{scikit-image}\footref{f:czi}


\section{Expected outcomes, success evaluation and metrics}
\subsection{Issue and PR curation}

Quantitatively evaluating maintenance work can be tricky, some Issues
or PRs can take minutes to review where as others can take days to
months of effort, however we believe that there is value at looking at
the net number of new Issues and Pull requests.  We will reduce this
number, ideally closing Issues and Pull Requests faster than they are
opened.  NumPy has had success in reversing the ever increasing trends
in the number of Issues / Pull Requests with paid
developers \footnote{https://github.com/seberg/numpy\_talk\_plots/blob/master/plots\_used\_in\_talk/issues\_prs\_delta.pdf}.


We will evaluate and label every open Issue and Pull Request
determining: assigning an action, a priority, and an estimated
difficulty.  Once that is done, we will aim to have all new Issues and
Pull Requests labeled within 7 days of being opened.


\subsection{Road-map and Architecture}

We will write a white paper and road map documenting the proposed
design, critical use-cases, and requirements for the data model and
API overhaul.

To validate the design, we will develop end-to-end prototypes
targeting one or more of the life-science libraries discussed above.

% JMK Does this section need more?

\section{Work Plan}

The funds will be paid to:


\begin{itemize}[noitemsep]

\item Fund Thomas Caswell's position at 40\%.  Caswell is
  currently the lead developer of Matplotlib and an Associate
  Computational Scientist at Brookhaven National Laboratory.  His
  long-term experience, API design expertise, and project leadership
  are critical to the success of the work in this proposal.  He will work
  on all aspects of the proposal.
\item Fund Hannah Aizenman's position for 12 months.  Aizenman has
  been a core-contributor Matplotlib for three years and is the author of a major recent feature set (support for string-categorical values).  She
  is a PhD candidate in computer science studying visualization at The
  City College of New York.  Her work on the architecture of
  Matplotlib will be the basis of her PhD thesis.  Aizenman will take
  the lead on the data model design and new-contributor on-boarding.
\item Fund 12 months of a yet-to-be identified software engineer to
  support all aspects of the proposal but focusing on maintenance,
  prototyping, and engaging down-stream libraries.
\item Travel to key Scientific and Python conferences (such as SciPy
  or PyCon) and for in-person meetings if required.
\end{itemize}

We want to use this dedicated effort to leverage and empower the
Matplotlib developer community.  In terms of direct work on the code
base an equal amount of time will be spent mentoring and reviewing
code from community members rather than directly implementing features
or fixing bugs.  All of the design work will be done in public with
input from the community.

% Part of this work is to develop the project road-map.


\section{Existing Support}

Thomas Caswell has 4hrs/wk from Brookhaven National Lab to work on
Matplotlib.


\clearpage
\bibliographystyle{alpha} % or named ?
\bibliography{biblo}

\end{document}
