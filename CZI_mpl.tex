\documentclass[11pt]{article}  % min is 11pt

\usepackage[margin=1in]{geometry}  % min is .5 in
\usepackage[shortlabels]{enumitem}
\usepackage{graphicx}
\usepackage[hidelinks]{hyperref}
\usepackage{caption}




\begin{document}
\title{Matplotlib - Foundation of Visualization in Python}
\author{}
\maketitle

\section{Goals}

The purpose of this proposal is to plan Matplotlib's evolution to meet
the visualization challenges of the coming decade and reduce backlog
of currently open Issues and Pull Requests.

By most measures Matplotlib is a wildly successful project; the source
has been actively developed and maintained by a vibrant primarily
volunteer community over the last 16 years and, conservatively, has
over a million users across the wide spectrum of fields, including
bio-medical imaging, microscopy, and genomics
\cite{Carpenter2006,Wolf2018,10.7717/peerj.453}
\cite{Segata2011,10.1371/journal.pgen.1000695,HASHIMSHONY2012666,
  10.1093/bioinformatics/bts480,Carlile2014,Laganowsky2014,Jiangaac9462,
  10.3389/fninf.2014.00014}.  We expect our user base to continue to
grow as Python is adopted by more scientists in the life sciences.
However, given the scale, scope, and importance of the project, we are
at the limit of what can be developed and maintained with primarily
volunteer effort.  This proposal identifies three key areas where we
need sustained support to ensure the health of the platform and
provide the leadership to meet the visualization challenges of the
next 16 years:

\begin{enumerate}[label=\alph*)]
  \item Maintenance of the library by curating existing and new Issues
    and Pull Requests.
  \item Developing a comprehensive plan to evolve the core architecture
    of Matplotlib.
  \item Developing the tools, documentation, and community to foster a
    rich eco-system of domain specific plotting tools built on
    Matplotlib.
\end{enumerate}

We propose to fund Thomas Caswell (PI) for 6 months, Hannah Aizenman
for 12 months, and a yet-identified software engineer for 12 months to
work on these tasks.  Caswell is the lead developer of Matplotlib and
an Associate Computational Scientist at Brookhaven National
Laboratory.  Aizenman is a core-contributor to Matplotlib, who has
previously worked on datatypes and outreach, and a PhD student in
computer science studying visualization at The City College of New
York.



\subsection{Curating Pull Requests and Issues}

The rate at which new Issues and Pull Requests come into the project
is out-pacing the rate at which volunteer effort can review them.
Over the past few years we have continued to merge PRs and close
issues about about [X per month], however new issues and PRs are opened
at a rate of [Y per month] which has produced a significant backlog.
This has resulted in useful contributions languishing in un-merged PRs
and bugs that break downstream packages going un-addressed.  This has
a deleterious effect on our community, discouraging new contributors,
and making it challenging to develop new contributors to the level of
familiarity with the code that they are able to review PRs. This leads
to an obvious negative feedback loop, where the community does not
grow in a healthy and sustainable manner.

We propose to fund Caswell, Aizenman, and the SWE to curate the open
issues and pull requests.  Specifically this work will involve:

\begin{itemize}
\item Sorting the current backlog of Issues and Pull Requests
  them in terms of how importance and how difficultly.
\item Ensuring that newly opened Issues are sorted and Pull Requests
  are reviewed in a timely manner.
\item On-boarded new contributors to the project team.  This is
  critical to sustaining and diversifying our developer community.
\item Maintaining Backward compatibility as much as practical.  If we
  do break API ensuring it is intentional and well documented.
\item Managing group decisions about proposed enhancements and
  features or breaking API.
\end{itemize}

None of this is to demote the importance of the volunteer
contributors, but instead to better co-ordinate and nurture their
efforts, with the goal of growing and sustaining a diverse community
of expert contributors.  This community will continue to sustain the
project in the future after this funding is exhausted.

\subsection{Road-map and Architecture Design}

The current
architecture\footnote{https://www.aosabook.org/en/matplotlib.html} of
Matplotlib was first designed 15 years ago \cite{Hunter:2007}.  That
it is still in use is a testament to its initial design, however it
does not reflect all of the developments in thinking around data
structures, software design, and visualization of the past decade.
Matplotlib does not natively know how to exploit structured data
(e.g. \texttt{pandas} or \texttt{xarray}) objects.  We will investigate
how to update Matplotlib's internal data model to leverage the
information embedded in structured data.  While there are downstream
domain specific libraries that are built on top of Matplotlib,
interoperability between core Matplotlib and each other can be
fraught.  We will develop plans of how to re-factor the core library
to allow easy extension and smooth interoperability between the core
library and mutually between the domain specific plotting tools.

We will develop clear requirement documents, document critical use
cases, implement prototypes, and engage with downstream users to
ensure that both the data model and API overhauls enable domain
specific plotting tools to be easily built on top of Matplotlib.


\subsubsection{Data Model}

``Structured data'' combines one or more arrays into an object that
also contains labels, dimensions, and co-ordinates of the data (i.e. a
map of global surface temperatures containing \texttt{T} ,
\texttt{latitude} and \texttt{longitude} being packed together in an
object along with all the relevant meta data).  In addition to the
data itself, these objects also carry information about the
relationship, implicitly or explicitly, between the components.
Currently Matplotlib asks the users or downstream libraries to split
this information into its components and pass them individually to
plotting methods, losing the structure and relation ships.
Internally, each plotting method (and \texttt{Artist}s, the objects
used to represent the plots) each handle sanitizing and storing user
input independently.  This means that some common functionality, such
as handling data with attached units (i.e. degrees Celsius) and the
data is in a structure we can work with, is scattered through out the
code base.  This leads to inconsistencies in the behavior across the
library and makes it difficult to write code that updates the user
data, critical for interactive exploration, streaming, and animation
use cases.


Here we propose to put significant effort into re-designing the
internal data model for Matplotlib and implementing a prototype.  The
goal is to have a simple model appropriate for the base Matplotlib
library and, more importantly, to have the technical underpinning in
place that will allow domain-specific downstream libraries be able to
handle structured and updating data in a coherent fashion.  By
removing the direct data storage from the \texttt{Artist}s and
defining an API for data objects we will make easy to:
\begin{itemize}
  \item implement smart down sampling of plotted data based on view
    limits
  \item seamlessly handling updating the underlying data, either
    streaming or interactively
  \item backing the plot with non-numpy arrays, including queries to a
    database
\end{itemize}
By defining a clear API to access data we will be able to de-couple
the development of the data access and the \texttt{Artist}s.  This
will enable implementations of the data layer that have exotic
dependencies to be used with \texttt{Artist}s from the core library or
third-party \texttt{Artist}s to rely on the data layer from the core
library.

\subsubsection{Homogenization of the API}

The library has grown organically over time through the contributions
of many people (approximately 900 individuals) and the code has
accumulated many small inconsistencies in the API.  Similar methods
have different argument order, \texttt{ax.text(x, y, s)} vs
\texttt{ax.annotation(s, (x, y))} and spelling/pluralization of
argument names, \texttt{color} vs \texttt{colors} through out the
library.  These subtle issues add friction for users, but are not easy
to fix.  The biggest problem to harmonizing our APIs and getting to
``one obvious way to do things'' is that due to our large user base
any API changes can have major negative impacts.  To bring all of the
APIs into harmony requires knowing what \textbf{all} of the APIs are
which requires dedicated effort.  We will have to carefully consider
what APIs to leave as they are, which to deprecate, and which to
replace.



\subsubsection{Rich Composite \texttt{Artist}s}
\texttt{Artist}s are the ``middle layer'' of Matplotlib that we use to
encode user-intent and ``draw'' themselves when displaying a figure to
the screen or saving to disk.  These are the objects that users
interact with to update the plotted data for interactive figures,
streaming data, and generating animations.  There is currently a mix
of ``primitive'' \texttt{Artist}s, for things like lines, images, and
patches, and ``composite'' artists for things like the whole
\texttt{Figure} or the \texttt{Axes}.  However, there is a gap in the
middle where we use a number of unconnected \textttt{Artist} instance
to represent multi-component plots.  For example, \texttt{errorbar}
creates up to 5 independent \textttt{Artist}s, if the user wants to
update the plot they must touch all 5 objects in turn.  Instead, we
should be providing the user with a single object on which they can
interact with to update all of the underlying \texttt{Artist}s.


\subsubsection{Functional API}






\subsubsection{new visitor patterns}

\begin{itemize}
\item currently have 'draw' which takes in a canvas and render's itself
\item add 'export' which will provide a high-level json-like (use to
  implement non-pickle save/restore, export to {bokeh, plotly,
    qtplotting})
\item add a lower-level scene-graph like representation (suitable to push to a GPU?)
\end{itemize}


\subsection{Coordination with downstream projects}

Much of the domain-specific specialization is carried in the semantics
of the structured data, so even once core Matplotlib can handle structured
data natively, there will still be a need for domain-specific tools.

Downstream libraries can provide any or all of tuned user-facing
functions, tuned artists, or a tuned data layer.

We will have to engage with current down stream projects to make sure
that our plans actually to make things easier for them.

Develop tools / documentation / guidelines to easily spin-up a new
downstream package.


\section{Work Plan}

The funds will be paid to:

\begin{itemize}

\item Fund Thomas Caswell's position for 6 months.  Caswell is
  currently the lead developer of Matplotlib.  His long-term
  experience, API design expertise, and project leadership are critical
  to the success of the work in this proposal.
\item Fund Hannah Aizenman's position for 12 months.  Aizenman has
  been a core-contributor Matplotlib for three years and has
  previously contributed support for string-categorical values.  Her
  work on the architecture of Matplotlib will be the basis of her PhD
  thesis.  Aizenman will take the lead on new-contributor on-boarding
  and the data model.
\item Fund 12 months of a yet-to-be identified software engineer to
  support all aspects of the proposal.
\item Travel to key Scientific and Python conferences (such as SciPy
  or PyCon) and for in-person meetings if required.
\end{itemize}

We want to use this dedicated effort to leverage and empower the
Matplotlib developer community.  In terms of direct work on the code
base an equal amount of time will be spent mentoring and reviewing
code from community members rather than directly implementing features
or fixing bugs.  All of the design work will be done in public with
input from the community.

Part of this work is to develop the project road-map.


\section{Existing Support}

Thomas Caswell has 4hrs/wk from Brookhaven National Lab to work on Matplotlib.


\clearpage
\bibliographystyle{alpha} % or named ?
\bibliography{biblo}

\end{document}
